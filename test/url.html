<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="de">
	<head>
		<title>URI Test</title>
		
		<link rel="stylesheet" type="text/css" href="./css/test.css" />
		
		<script type="application/javascript" src="../lib/URL.js"></script>
		
		<script type="text/javascript">
			window.addEventListener('DOMContentLoaded', function() {
				debugger;
				
				var body = document.querySelector('body');
				
				var input = document.createElement('input');
				input.setAttribute('type', "text");
				input.value = "http://user:password@files.localnet:80/URL/test/url.html?q=test&item=abc,xyz,stu#location";
				input.addEventListener('keyup', onKeyUp, false);
				body.appendChild(input);
				
				var output = document.createElement('div');
				output.className = "output";
				body.appendChild(output);
				
				function onKeyUp() {
					var strurl = input.value;
					
					for (var node = output.firstChild; node; node = output.firstChild) output.removeChild(node);
					
					node = document.createElement('p');
					
					try {
						var scheme = URIComponent.URIString(strurl, URIComponent.prototype.TYPE_SCHEME);
						var user   = URIComponent.URIString(strurl, URIComponent.prototype.TYPE_USER);
						var name   = URINameComponent.URIString(strurl);
						var port   = URIComponent.URIString(strurl, URIComponent.prototype.TYPE_PORT);
						var path   = URIComponent.URIString(strurl, URIComponent.prototype.TYPE_PATH);
						var query  = URIComponent.URIString(strurl, URIComponent.prototype.TYPE_QUERY);
						var frag   = URIComponent.URIString(strurl, URIComponent.prototype.TYPE_FRAGMENT);
						
						if (!scheme.empty) {
							var child = document.createElement('span');
							child.className = "scheme";
							child.textContent = scheme;
							node.appendChild(child);
							
							node.appendChild(document.createTextNode(":"));
						}
						
						if (!user.empty) {
							node.appendChild(document.createTextNode("//"));
							
							child = document.createElement('span');
							child.className = "user";
							child.textContent = user;
							node.appendChild(child);
							
							node.appendChild(document.createTextNode("@"));
						}
						
						if (!name.empty) {
							if (user.empty) node.appendChild(document.createTextNode("//"));
							
							child = document.createElement('span');
							child.className = "name";
							node.appendChild(child);
							
							var segment = name.segment;
							
							for (var i = segment.length - 1; i > -1; i--) {
								var segmentNode = document.createElement('span');
								segmentNode.className = "name-segment";
								segmentNode.textContent = segment[i];
								child.appendChild(segmentNode);
								
								child.appendChild(document.createTextNode("."));
							}
							
							child.removeChild(child.lastChild);
						}
						
						if (!port.empty) {
							node.appendChild(document.createTextNode(":"));
							
							child = document.createElement('span');
							child.className = "port";
							child.textContent = port;
							node.appendChild(child);
						}
						
						if (!path.empty) {
							child = document.createElement('span');
							child.className = "path";
//							if (path.absolute) child.classList.add('abs');
//							if (!path.resource) child.classList.add('end');
							child.textContent = path;
							node.appendChild(child);
						}
						
						if (!query.empty) {
							node.appendChild(document.createTextNode("?"));
							
							child = document.createElement('span');
							child.className = "query";
							child.textContent = query;
							node.appendChild(child);
						}
						
						if (!frag.empty) {
							node.appendChild(document.createTextNode("#"));
							
							child = document.createElement('span');
							child.className = "frag";
							child.textContent = frag;
							node.appendChild(child);
						}
						
						if (node.childNodes.length) {
							node.appendChild(document.createTextNode(" parsed."));
							output.appendChild(node);
							
							return;
						}
						
						child = document.createElement('span');
						child.className = "none";
						child.textContent = "empty";
						node.appendChild(child);
						output.appendChild(node);
						
						return;
					} catch(err) {
						node = document.createElement('p');
						
						child = document.createElement('span');
						child.className = 'string';
						child.textContent = strurl;
						node.appendChild(child);
						
						node.appendChild(document.createTextNode(" not parsed. reason: "));
						
						child = document.createElement('span');
						child.className = 'error';
						child.textContent = err;
						node.appendChild(child);
						
						node.appendChild(document.createTextNode("."));
					}
					
					output.appendChild(node);
				}
				
				
				onKeyUp(null);
			}, false);
		</script>
	</head>
	
	<body></body>
</html>